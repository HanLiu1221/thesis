
% Thesis Introduction File

\chapter{Introduction}

A variety of modeling tools (e.g., Maya, SketchUp, etc) have been developed to ease the creation of 3D contents in past decades. Creating from scratch, however, is still challenging for novice users since it requires professional skills and the creativity. With the expansion of online repositories of 3D models, creative shapes can be created from existing models automatically for users. One of the most popular methods is part-based modeling~\cite{Funkhouser2004}. The idea is to split example geometry into smaller shape parts and then reassemble them to obtain shape variations, especially for man-made objects. These objects have similar structures (e.g., symmetry, orthogonality, etc.) that can be identified from large classes of models and further can be characterized in a consistent way for analysis and synthesis. Structure-aware shape processing has been recently surveyed by Mitra et al.~\cite{MitraSTAR2013}. It is usually performed by three main stages: model decomposition, component-based analysis and shape synthesis.

After the input geometry is decomposed into disjoint parts, a relation graph can be built that encodes parts as nodes connected by edges to capture the coarse-scale model topology~\cite{Zheng:2013,topoVarying14}. Based on the part relations, component-based shape analysis has been widely applied serving different modeling purposes, such as layout design (e.g., floor-plan, facades, etc.) and shape variation (e.g., furniture, architectures, etc.). Current approaches in component-based analysis rely on the abstractions of structural relations between shape parts. Such relations like symmetry and planarity are extracted using various optimization strategies, which can only be applied to models that have regular patterns. Besides, users are overlooked in the modeling process. User interactions are usually required in the first stage of shape processing, like annotation of semantic parts, but users can seldom intervene in the automatic model generation afterwards. In sketch based design, users are given more freedom to sketch out their ideas, however, they are restricted by certain requirements such as anchoring a spatial canvas~\cite{ilovesketch08}. In this thesis, we break the limitation of defining specific structural relations, and perform the modeling process with just the intrinsic relations that capture the connectivity of shape parts. Based on a graph representation that depicts part relations, we develop a few tools that support user designs for interior layout exploration, for part-based modeling with replaceable substructures, and for context-inferred interpretation of sketches (Figure~\ref{fig:work_flow}). In the following sections of this chapter, we will introduce the problems studied in these instantiations, as well as our contributions.

\begin{figure}[t!]
  \includegraphics[width=\columnwidth]{./images/introduction/flow.pdf}
  \caption[Work flow.]{The work flow. Starting from the graph representation of inputs, we introduce our modeling process in interior layout exploration, part-based modeling with replaceable substructures, and context-inferred interpretation of sketches.}
  \label{fig:work_flow}
\end{figure}


\section{Graph-based shape abstraction}

Graph can naturally depict inner relations of shape parts and therefore is frequently used in analyzing shape structures in part-based modeling. The modeling procedure usually involves segmenting models into disjoint parts, inducing relational rules and re-assembling shape parts. Combination rules can be derived from the decomposition of models, suggesting how a new shape is created by recombing necessary segments. A graph is built from the segmentation of an input model, by taking components as nodes and their relations as edges. The components can be semantic parts of a shape, rooms in a building layout, or strokes in a sketch. Figure~\ref{fig:intro_shape_graph}(a) is a design graph of a residential layout, where the scale of each node represents the size of the corresponding room, and edges are the required connections. In Figure~\ref{fig:intro_shape_graph}(b), a chair is simply decomposed to three semantic parts, seat, back and legs. Symmetry and contact edges indicate the relations of the two corresponding components. In our work, we only consider the contact relations that are derived directly from model segmentation.

\begin{figure}\centering
  \includegraphics[width=\textwidth]{./images/introduction/shape_graph.pdf}
  \caption[An example of shape graph.]{An example of shape graph. The nodes denote segments of the chair model by corresponding colors while edges denote the relations between segments.}
  \label{fig:intro_shape_graph}
\end{figure}

\mypara{Shape components}
%
In building layout design, the shape components are defined as input rooms to be assigned by dividing the given space. In part-based modeling, Model segmentation is an underlying problem in shape analysis. A number of unsupervised and supervised methods for mesh segmentation have been proposed for detecting part boundaries~\cite{Sidi11,Wang12} and summarized in a survey~\cite{shamir2008survey}. However, fully automatic segmentation still remains a hard problem especially for semantic partitions. For example, a model with self repetitions like building facades needs detail preserved segmentation, while a mechanical model such as an excavator requires a coarse but functional decomposition. As our work focuses on creating models from a small group of shapes, we use manual segmentation by simply grouping mesh parts. Previous work like modeling by example~\cite{Funkhouser2004}, pioneered in part based modeling, let users cut a model by simply painting on the mesh. ShapeAnnotator~\cite{attene:09} proposed to annotate a surface mesh with semantics. In our work, we provide an interactive tool to select a group of components by mouse dragging and then mark it a type of shape part by assigning a color index, see the segmentation of a chair in Figure~\ref{fig:intro_shape_graph}(a). For sketch based design, the shape components correspond to a group of user strokes lying on the same plane. We obtain it by decomposing user strokes and coupling coplanar strokes with respect to their vanishing directions.

\mypara{Inner relations between shape components}
%
How shape parts connect to each other is the key to re-assemble shape components. An intuitive relation is the connectivity of parts. In a higher level, it can be an specific feature of some similar parts such as repetition, or pairwise correlations like orthogonality and coplanarity. The iWires system~\cite{Gal2009} introduced structure-aware editing which inspired subsequent works on preserving structural relations of shape components. The identified relations between shape parts (e.g., parallel, orthogonal, symmetry, etc) are used to guide the generation of valid models that preserve such relations. We use the graph representation for each shape, where specific relations can be assigned to the edges. Graph operations are then defined towards node connections, based on which the validity of new graphs can be evaluated. Instead of defining featured edges like symmetry in Figure~\ref{fig:intro_shape_graph}, our work relies only on the topological relations, i.e., contacts. From the abstracted graph representations of input models, we extract the contact relations between shape parts, analyze at the component level and synthesize models with optimization formulations preserving the connectivity.

\mypara{Assembly constraints}
%
The geometric plausibility has to be preserved at local level, as well as the global structure. Local constraints enforce the local neighborhoods of the synthesized shapes must look plausible, regardless of the overall shape. The constraints are usually formulated as geometric similarity of all local neighborhoods to portions of the example data. This constrains the connections between parts, as exemplified in the input, such as the contact between a table top and table legs, or the contact between a bedroom with a hall. Global constraints describe non-local correlations in part usage to preserve the validity of shapes such as functional or physical attributes~\cite{mitra_howThingsWork_sig_10,Zheng:2013}. Based on human perception, functions can be extracted from part connections such as supporting if one component underlies the other components. In addition, global constraints of a model usually involve a validation check. For example, to create a valid floor plan, reasonable room space has to be guaranteed, as well as unblocked paths that can lead to each room from the entry. Another example is the design of furniture, the ground touching parts have to be stable for supporting the whole structure. Additional design constraints can also be incorporated according to user requirements such as the construction cost which will be explained in detail in the following chapters.

%The global constraints are key to classify different families of shapes, which describe non-local correlations in part usage. An early understanding of shape functionality is the upright orientation of objects~\cite{Fu2008}. Then, Zheng et al.~\cite{Zheng:2013} proposed symmetric functional arrangement of man-made objects and studied three types of the arrangement, i.e., support, embed, and placement. In fact, such functionalities can be abstracted in a higher level by interacting with humans, known as ergonomics. Ergonomics factors are encoded in the furniture arrangement~\cite{yu2011make} for interior layout generation. The Shape2Pose system\cite{Kim:2014:SHS} analyzed the contact relations between human body and shapes to predict poses for given models. In a related work ~\cite{zldm_ergonomics_tvcg15}, we abstracted ergonomics guidelines and associated it with shape constraints. Take a chair for example, the height of the chair seat has to allow both feet supported by ground, while the width and the depth should conform to human's dimensions. Therefore, the length of chair legs binds with the length of human legs, and the width of chair seat binds with waistlines. Such constraints can be easily adapted to other models like bikes and gym equipments.

%In this thesis, we consider both the local consistency and global functionality of shapes. Replaceable substructures are discovered in a single shape or across different shapes, the boundaries of which have to be matched to enable interchangeable topologies. We then extend our method to take into account global constraints as well. In our current implementation, we examine a small set of representative examples such as topological constraints to ensure routes between entry-exit points, geometric constraints to ensure stability and functional validity of models.

Based on the graph representation, we introduce the following three developed modeling tools in our work.

\section{Interior layout design}

The design of interior layout is to arrange input rooms in a given envelope or to approximate space area under the scale and connectivity constraints. The input includes certain user requirements like room sizes and relations. There can also be accessibility considerations, for example, a bathroom is preferably attached to the main bedroom; the dining room should be next to the kitchen. Furthermore, as a sanity measure, all the rooms should be accessible by connected paths from the main door. In the case of multi-storied buildings, there are additional constraints, e.g., the position and the dimensions of stairs have to match across different floors.

In our setup, the user first indicates global functional specializations by prescribing approximate area of each room and a connectivity graph indicating the desired inter-room connections. Subsequently, the system returns realizations conforming to the input constraints. Even when such a layout satisfies all the predefined conditions, users may still want to tune the design, such as changing room areas or swapping pairs of rooms. More importantly, being oblivious to the final construction, the user designed floor plan may be ill-suited to the actual manufacturing process, and thus be expensive. Hence, besides ensuring functional floor plan when the user manipulates any suggested design, we specially optimize the geometric realization to produce economic constructions. Thus, both functional and fabrication constraints are considered in our proposed interactive design system.


\section{Part-based modeling}

In part-based modeling, an intuitive approach to generate new models is to switch those corresponding parts. Besides of one-to-one replacement, reshuffling similar substructures produce more variations with topology changes. In addition to preserving geometry consistency of synthesized shapes, we also integrate simple global constraints to examine the validity of results.

We start by building a theoretical framework for part-based shape modeling, describing models as shape graphs and reducing consistency conditions as pairwise constraints corresponding to the formal construct of a tiling grammar. As a negative result, we show that such a modeling problem is undecidable and even restricted variants, e.g., shape synthesis with limited number of pieces, is NP-hard. We propose a suitable restriction of the search space that trades-off some variability for efficiency. Rather than synthesizing new shapes from scratch, the algorithm enumerates all possible replacements of subgraphs of an existing shape graph, which, surprisingly, can be achieved in low-order polynomial time under mild restrictions. Specifically, we obtain an algorithm with quadratic time complexity in two steps: (i) We assume a local ordering of outgoing edges in each node, which is trivial for manifold models. (ii) We factor out an exponential overhead of redundant solutions with equivalent effect. We improve practical performance further by working with the dual of the original shape graphs to encodes inter-part connectivity. Here, the large class of candidate variations considered at once by our approach permits a more efficient discovery of solutions than a naive part-by-part assembly strategy.

\section{Sketching 3D context}

Users are restricted in interacting the design process at a high level, as described in the previous modeling step. Models are already shaped in an initial stage and presented to users, i.e., a floor plan, and input shape space. Professional users like artists and designers favor sketching out their ideas, e.g., plans for a house, the layout of a plaza, a set design for the theater, or placement of a new bridge. Sketching is fast, fluid, and iterative. Although sketch is guided by imagination, it is also referential when set in space, or when building on some previous idea or design. Naturally, when a sketch is made to record an observation, it is by definition tied to a physical setting~\cite{NecessityDrawing77}. Therefore, as the artist or designer draws and redraws, she not only refines the object, she also explores the physical setting in which the object or design will be placed.

Traditional sketch on paper is limited to a single viewpoint. The missing 3D information hinders exploration of the scene under different views or perspective perturbations, or selectively moving around objects, or conceptualizing larger design modifications.  When the designer re-sketches to explore another view, unfortunately she cannot use or reference previous drawings. Transforming such sketches to 3D is difficult. The sketched scenes are largely virtual and hence common vision-based reconstructions are not directly applicable; the sketches are rough, incomplete, and only indicative of the actual 3D curves, i.e., they lack any depth information; and often the sketches are from single viewpoints. If the designer chooses to design from the start in 3D using available or specialized CAD modeling tools, she is committed to a more restrictive, time-consuming and tedious approach that requires exact specifications and details from the start of the process. This invariably inhibits, rather than expands, the scope of exploration~\cite{sketchBook:11}. In effect, the designer trades some measure of artistic spontaneity and freedom for the precision of CAD software.

We observe that many architectural and industrial design settings are man-made scenes with primarily regular objects. Such objects are either mutually well-aligned, or near-regularly arranged. Hence, their embedding planes provide rich context that can be leveraged to interpret user strokes. We present an interactive design abstraction tool for the artists. To begin, given a single image or sketch, the user calibrates the scene by annotating a few lines. As the user continues to sketch, our system automatically partitions the sketched lines, groups them, and guesses their intersection pattern. Once finished, she can either approve the grouping and intersection suggestions, or manually override them. Then, in the key step, our system simultaneously lifts all the sketched curves to 3D via a novel context-guided labeling formulation. Intuitively, by assuming the user strokes to be planar, we can simultaneously assign embedding planes for all the strokes that lead to a regular arrangement in space. Technically, the existing context is used to create initial candidate planes for the above labeling. Surprisingly, this provides enough regularization to extract a good scene abstraction. The process continues with the inferred abstraction providing enriched context for subsequent sketch interpretation. Thus, as the scene context gets progressively enriched, sketch interpretation gets simpler. The extracted abstraction can then be used as billboard proxies for view perturbations and  inspection for subsequent design modifications.

\begin{figure}[t!]\centering
  \includegraphics[width=\textwidth]{./images/introduction/sketch_graph.pdf}
  \caption[An example of 2D sketch.]{An example of 2D sketch (a). The crosses denote graph edges that connect the user strokes (nodes) indicated by different colors (b), and the resulted 3D model (c).}
  \label{fig:intro_sketch_graph}
\end{figure}

\section{Contributions}

In this thesis, we present efficient modeling solutions using graph representations. In part-based modeling, graph edges represent the topological connections of shape parts, from which we apply the extracted connection rules to create new shapes. In a further implementation, we abstract 3D forms of user sketches in 2D. The graph edges then denote the connections between strokes (see Figure~\ref{fig:intro_sketch_graph}(b)), from which we formulate a selection optimization to find out the arrangement of canvases hosting strokes (Figure~\ref{fig:intro_sketch_graph}(c)).

%\subsection{Formulating manufactural constraints}
\mypara{Formulating fabrication constraints}
Based on existing techniques of automatic layout generation, we introduce a fabrication-aware approach to reshape floor plans. Starting from an initialization of room layout according to input requirements, users are allowed to interact with the suggested layout. Our interface adaptively optimizes the global arrangement of rooms under geometric and fabrication constraints. Specifically, we focus on precast concrete based buildings with the aim to save construction cost by reducing the number of cuts on slabs. The global optimization is followed by a reshaping that calculates the best usage of concrete slabs for the entire building.

%\subsection{Fast subgraph search during progressive editing}
\mypara{Efficient subgraph search}
We formulate a theoretical framework for part-based shape modeling. We analyze the NP-hard synthesis problem and propose a polynomial time algorithm. As the main algorithmic contribution, we describe a novel algorithm that efficiently enumerates all replaceable substructures that lead to shape modification operations. With the shape graph representation, we learn the docking rules and search for replaceable substructures with local consistency. The search is implemented in one model or across multiple models. As long as a pair of substructure can be found, where the boundaries match exactly while the interior can be ignored. By switching or replacing subregions, new models are iteratively produced and used for the next generation of analysis and synthesis. We also introduce several simple global constraints for evaluating the functionality of shape variations.

%\subsection{Inferring 3D canvases for 2D sketches}
\mypara{Inferring 3D canvases for 2D sketches}
We propose a sketching system that approximates 3D canvases of user strokes. Taking an arbitrary image (e.g., natural scene, street view, etc) as the canvas, we first prepare the sketch space by calibrating the camera and inform the user of the perspective respecting the background image. When the user sketches, our system performs a background analysis on the strokes by automatic segmentation and grouping, following by solving a selection problem for context-inferred canvas planes. We test the usability of our system by a user study and collect the sketching results from designers, artists and students with computer graphics background.

\section{Thesis layout}

This thesis is organized as follows. Chapter 2 is a literature study on related work towards part-based modeling, interior layout creation, and inferring the 3D context from 2D sketches. We introduce our work in the following chapters on 2D and 3D graph operations, demonstrated by three instantiations. In Chapter 3, we present the layout generation from a 2D design graph, satisfying a set of constraints including fabrication considerations. In Chapter 4, we explore 3D shape graph to create shape variations from a single shape or a group of models. Int Chapter 5, we reconstruct 3D canvases from user sketches in a given context by analyzing coplanar strokes, and present a set of sketching results from both professional and non-professional users. We then conclude with a discussion of the current and future work in chapter~\ref{chapter:conclusion}.
